<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Programa Everest — Simulador</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Simulador de variables y decisiones del Programa Everest (casino): omnicanalidad, satisfacción, riesgo, margen, popularidad, sala/online y éxito." />
  <style>
    :root { --card: 18 24 40; --ink: 245 246 248; }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.08); }
    .metric-shadow { box-shadow: 0 8px 24px rgba(0,0,0,.25); }
    input[type="range"] { accent-color: #60a5fa; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-950 to-slate-900 text-slate-100">
  <header class="px-6 md:px-10 py-6 flex items-center justify-between">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">Programa <span class="text-blue-300">Everest</span> · Simulador</h1>
    <div class="flex items-center gap-2 text-xs md:text-sm">
      <button id="btnReset" class="px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700">Restablecer</button>
      <button id="btnExport" class="px-3 py-2 rounded-xl bg-blue-600 hover:bg-blue-500">Exportar JSON</button>
      <label class="px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 cursor-pointer">Importar JSON
        <input id="fileImport" type="file" accept="application/json" class="hidden" />
      </label>
    </div>
  </header>

  <main class="px-6 md:px-10 pb-20">
    <!-- Estado / métricas -->
    <section class="grid lg:grid-cols-3 gap-6">
      <!-- Panel variables -->
      <div class="lg:col-span-2 glass rounded-3xl p-6 metric-shadow">
        <div class="flex items-start justify-between gap-4 mb-4">
          <h2 class="text-xl font-semibold">Variables del sistema</h2>
          <label class="flex items-center gap-2 text-xs"><input id="linkSO" type="checkbox" class="scale-110" checked> Vincular Sala ↔ Online</label>
        </div>

        <div id="controls" class="grid md:grid-cols-2 gap-5">
          <!-- Plantilla de control (se rellena por JS) -->
        </div>
      </div>

      <!-- Panel Éxito -->
      <div class="glass rounded-3xl p-6 metric-shadow">
        <h2 class="text-xl font-semibold mb-4">Éxito del Casino</h2>
        <div class="rounded-2xl bg-slate-900 p-5 grid gap-4">
          <div class="flex items-baseline justify-between">
            <div>
              <div class="text-5xl font-bold" id="exitoValue">0</div>
              <div class="text-xs text-slate-400">(0–100) · Promedio ponderado</div>
            </div>
            <div>
              <span id="exitoBadge" class="px-3 py-1 rounded-full text-xs bg-slate-800">–</span>
            </div>
          </div>
          <div class="text-xs text-slate-300 leading-relaxed">
            Fórmula: 0.30×Satisfacción + 0.25×Margen + 0.25×Popularidad + 0.20×(100 − Riesgo)
          </div>
          <div class="h-3 w-full rounded-full bg-slate-800 overflow-hidden">
            <div id="exitoBar" class="h-full bg-blue-500" style="width:0%"></div>
          </div>
        </div>

        <div class="mt-6 text-xs text-slate-300">
          <h3 class="font-semibold mb-2">Umbrales</h3>
          <ul class="list-disc ml-5 space-y-1">
            <li><b>&lt;40</b>: fracaso operativo</li>
            <li><b>40–60</b>: inestable</li>
            <li><b>60–75</b>: correcto</li>
            <li><b>75–90</b>: muy bueno</li>
            <li><b>&gt;90</b>: excelencia</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Panel decisiones / Campamento Base -->
    <section class="mt-8 glass rounded-3xl p-6 metric-shadow">
      <div class="flex items-start justify-between gap-4 mb-4">
        <h2 class="text-xl font-semibold">Campamento Base · Captación de clientes</h2>
        <span class="text-xs text-slate-400">Aplica efectos predefinidos (clamp 0–100)</span>
      </div>

      <div class="grid md:grid-cols-2 xl:grid-cols-4 gap-4">
        <button data-scenario="colaboradores" class="scenario p-4 rounded-2xl bg-slate-900 hover:bg-slate-800 text-left">
          <div class="font-semibold">Sala con colaboradores</div>
          <p class="text-xs text-slate-300 mt-1">↓ riesgo · ↑ omnicanal · ↓ popularidad · ↑ margen · ↑ sala</p>
        </button>
        <button data-scenario="tv" class="scenario p-4 rounded-2xl bg-slate-900 hover:bg-slate-800 text-left">
          <div class="font-semibold">Campaña en TV</div>
          <p class="text-xs text-slate-300 mt-1">↓ margen · ↓ omnicanal · ↑ riesgo · ↑ popularidad</p>
        </button>
        <button data-scenario="twitch" class="scenario p-4 rounded-2xl bg-slate-900 hover:bg-slate-800 text-left">
          <div class="font-semibold">Streamers en Twitch</div>
          <p class="text-xs text-slate-300 mt-1">↓ margen · ↑ riesgo · ↑ popularidad (moderada)</p>
        </button>
        <button data-scenario="buscadores" class="scenario p-4 rounded-2xl bg-slate-900 hover:bg-slate-800 text-left">
          <div class="font-semibold">Buscadores en internet</div>
          <p class="text-xs text-slate-300 mt-1">↑ margen · ↑ riesgo (ligero) · ↑ popularidad (ligera)</p>
        </button>
      </div>

      <div id="scenarioNote" class="mt-4 text-xs text-slate-300 hidden"></div>
    </section>

    <!-- Leyenda de umbrales -->
    <section class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Satisfacción del cliente</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>&lt;40: abandono</li>
          <li>40–50: muy mala</li>
          <li>50–60: mala</li>
          <li>80–90: buena</li>
          <li>&gt;90: excelente (recomienda)</li>
        </ul>
      </div>
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Riesgo del cliente</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>&lt;30: bajo</li>
          <li>30–60: medio</li>
          <li>60–80: alto</li>
          <li>&gt;80: crítico</li>
        </ul>
      </div>
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Popularidad</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>&lt;40: desconocido/mala imagen</li>
          <li>40–60: nicho</li>
          <li>60–80: notable</li>
          <li>80–90: popular</li>
          <li>&gt;90: fenómeno</li>
        </ul>
      </div>
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Omnicanalidad</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>&lt;40: muy baja</li>
          <li>40–60: media</li>
          <li>60–80: buena</li>
          <li>&gt;80: excelente</li>
        </ul>
      </div>
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Margen del casino</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>&lt;20: insostenible</li>
          <li>20–40: bajo</li>
          <li>40–60: correcto</li>
          <li>60–80: óptimo</li>
          <li>&gt;80: excelente (ojo satisfacción)</li>
        </ul>
      </div>
      <div class="glass rounded-3xl p-5">
        <h3 class="font-semibold mb-3">Sala / Online</h3>
        <ul class="text-xs space-y-1 text-slate-300">
          <li>Vinculados por defecto: Online = 100 − Sala</li>
          <li>Con alta omnicanalidad (&gt;80) el desbalance penaliza menos la satisfacción</li>
        </ul>
      </div>
    </section>
  </main>

  <footer class="px-6 md:px-10 py-8 text-xs text-slate-400">
    Programa Everest · prototipo estático (index.html)
  </footer>

  <script>
    // ----------------------------
    // Modelo base del sistema
    // ----------------------------
    const state = {
      Omnicanalidad: 55,
      Satisfaccion: 75,
      Riesgo: 35,
      Popularidad: 60,
      Margen: 55,
      Sala: 50,
      Online: 50,
      linkSO: true
    };

    const weights = { Satisfaccion: 0.30, Margen: 0.25, Popularidad: 0.25, Riesgo: 0.20 };

    // Deltas predefinidos para escenarios del Campamento Base
    const scenarios = {
      colaboradores: {
        label: 'Sala con colaboradores',
        deltas: { Omnicanalidad: +10, Riesgo: -10, Popularidad: -5, Margen: +10, Sala: +10, Online: -10, Satisfaccion: +3 }
      },
      tv: {
        label: 'Campaña en TV',
        deltas: { Margen: -10, Omnicanalidad: -10, Riesgo: +10, Popularidad: +20, Satisfaccion: -5, Online: +5 }
      },
      twitch: {
        label: 'Streamers en Twitch',
        deltas: { Margen: -8, Riesgo: +12, Popularidad: +8, Satisfaccion: -3, Online: +10 }
      },
      buscadores: {
        label: 'Buscadores en internet',
        deltas: { Margen: +12, Riesgo: +5, Popularidad: +5, Satisfaccion: 0, Online: +12 }
      }
    };

    // ----------------------------
    // Utilidades
    // ----------------------------
    const clamp = (v, min=0, max=100) => Math.max(min, Math.min(max, v));

    function qualitative(key, value){
      switch(key){
        case 'Omnicanalidad': return value < 40 ? 'muy baja' : value < 60 ? 'media' : value < 80 ? 'buena' : 'excelente';
        case 'Satisfaccion': return value < 40 ? 'abandono' : value < 50 ? 'muy mala' : value < 60 ? 'mala' : value < 80 ? 'aceptable' : value < 90 ? 'buena' : 'excelente';
        case 'Riesgo': return value < 30 ? 'bajo' : value < 60 ? 'medio' : value < 80 ? 'alto' : 'crítico';
        case 'Popularidad': return value < 40 ? 'desconocido' : value < 60 ? 'nicho' : value < 80 ? 'notable' : value < 90 ? 'popular' : 'fenómeno';
        case 'Margen': return value < 20 ? 'insostenible' : value < 40 ? 'bajo' : value < 60 ? 'correcto' : value < 80 ? 'óptimo' : 'excelente';
        case 'Sala': return value + '%';
        case 'Online': return value + '%';
        case 'Exito': return value < 40 ? 'fracaso' : value < 60 ? 'inestable' : value < 75 ? 'correcto' : value < 90 ? 'muy bueno' : 'excelencia';
      }
      return '';
    }

    function badgeColor(key, value){
      const ok = 'bg-emerald-600';
      const meh = 'bg-amber-500';
      const bad = 'bg-rose-600';
      switch(key){
        case 'Riesgo': return value < 60 ? ok : value < 80 ? meh : bad;
        case 'Satisfaccion': return value >= 80 ? ok : value >= 60 ? meh : bad;
        case 'Omnicanalidad': return value >= 60 ? ok : value >= 40 ? meh : bad;
        case 'Popularidad': return value >= 60 ? ok : value >= 40 ? meh : bad;
        case 'Margen': return value >= 60 ? ok : value >= 40 ? meh : bad;
        default: return 'bg-slate-700';
      }
    }

    function computeExito(){
      const { Satisfaccion, Margen, Popularidad, Riesgo } = state;
      const ex = (
        Satisfaccion * weights.Satisfaccion +
        Margen * weights.Margen +
        Popularidad * weights.Popularidad +
        (100 - Riesgo) * weights.Riesgo
      );
      return Math.round(ex);
    }

    function crossEffects(){
      // Efectos cruzados suaves
      if(state.Popularidad > 80){ state.Riesgo = clamp(state.Riesgo + 10); state.Margen = clamp(state.Margen - 5); }
      if(state.Margen > 80){ state.Satisfaccion = clamp(state.Satisfaccion - 10); }
      if(state.Omnicanalidad > 80){ state.Riesgo = clamp(state.Riesgo - 10); state.Satisfaccion = clamp(state.Satisfaccion + 5); }

      // Penalización si Sala/Online muy desbalanceados y poca omnicanalidad
      const imbalance = Math.abs(state.Sala - state.Online);
      if(imbalance > 40 && state.Omnicanalidad < 60){
        state.Satisfaccion = clamp(state.Satisfaccion - 5);
      }
    }

    function save(){
      try{ localStorage.setItem('everest_state', JSON.stringify(state)); }catch(e){}
    }
    function load(){
      try{
        const raw = localStorage.getItem('everest_state');
        if(raw){ Object.assign(state, JSON.parse(raw)); }
      }catch(e){}
    }

    // ----------------------------
    // UI
    // ----------------------------
    const controls = [
      { key:'Omnicanalidad', label:'Omnicanalidad' },
      { key:'Satisfaccion', label:'Satisfacción del cliente' },
      { key:'Riesgo', label:'Riesgo del cliente' },
      { key:'Popularidad', label:'Popularidad del casino' },
      { key:'Margen', label:'Margen del casino' },
      { key:'Sala', label:'Sala (peso % actividad)' },
      { key:'Online', label:'Online (peso % actividad)' },
    ];

    function renderControls(){
      const wrap = document.getElementById('controls');
      wrap.innerHTML = '';
      controls.forEach(c => {
        const val = state[c.key];
        const card = document.createElement('div');
        card.className = 'rounded-2xl bg-slate-900 p-4';
        card.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <label class="font-medium">${c.label}</label>
            <span id="badge-${c.key}" class="px-2 py-1 rounded-full text-[10px] ${badgeColor(c.key, val)}">${qualitative(c.key, val)}</span>
          </div>
          <div class="flex items-center gap-3">
            <input id="range-${c.key}" type="range" min="0" max="100" step="1" value="${val}" class="w-full" />
            <div class="w-14 text-right text-sm tabular-nums" id="val-${c.key}">${val}</div>
          </div>
          <div class="h-2 w-full mt-2 rounded bg-slate-800 overflow-hidden">
            <div id="bar-${c.key}" class="h-full bg-blue-500" style="width:${val}%"></div>
          </div>
        `;
        wrap.appendChild(card);

        card.querySelector(`#range-${c.key}`).addEventListener('input', (e) => {
          const newVal = parseInt(e.target.value, 10);
          if(c.key === 'Sala' && document.getElementById('linkSO').checked){
            state.Sala = newVal; state.Online = clamp(100 - newVal); // vinculado
            updateControl('Sala'); updateControl('Online');
          } else if(c.key === 'Online' && document.getElementById('linkSO').checked){
            state.Online = newVal; state.Sala = clamp(100 - newVal); // vinculado
            updateControl('Online'); updateControl('Sala');
          } else {
            state[c.key] = newVal;
            updateControl(c.key);
          }
          updateAll();
        });
      });
    }

    function updateControl(key){
      const v = clamp(state[key]);
      state[key] = v;
      const badge = document.getElementById(`badge-${key}`);
      const valEl = document.getElementById(`val-${key}`);
      const bar = document.getElementById(`bar-${key}`);
      const range = document.getElementById(`range-${key}`);
      if(badge){ badge.textContent = qualitative(key, v); badge.className = `px-2 py-1 rounded-full text-[10px] ${badgeColor(key, v)}`; }
      if(valEl) valEl.textContent = v;
      if(bar) bar.style.width = v + '%';
      if(range && parseInt(range.value,10) !== v){ range.value = v; }
    }

    function renderExito(){
      const exito = computeExito();
      const badge = document.getElementById('exitoBadge');
      const bar = document.getElementById('exitoBar');
      const val = document.getElementById('exitoValue');
      val.textContent = exito;
      bar.style.width = exito + '%';
      const q = qualitative('Exito', exito);
      badge.textContent = q;
      badge.className = 'px-3 py-1 rounded-full text-xs ' + (exito>=75 ? 'bg-emerald-600' : exito>=60 ? 'bg-amber-500' : exito>=40 ? 'bg-yellow-700' : 'bg-rose-600');
    }

    function updateAll(){
      // Reaplicar vinculaciones
      state.linkSO = document.getElementById('linkSO').checked;

      // Recalcular efectos cruzados sobre una copia para no acumular drift accidental
      const snapshot = { ...state };
      state.Omnicanalidad = clamp(snapshot.Omnicanalidad);
      state.Satisfaccion  = clamp(snapshot.Satisfaccion);
      state.Riesgo        = clamp(snapshot.Riesgo);
      state.Popularidad   = clamp(snapshot.Popularidad);
      state.Margen        = clamp(snapshot.Margen);
      state.Sala          = clamp(snapshot.Sala);
      state.Online        = clamp(snapshot.Online);

      crossEffects();

      // Sync UI
      controls.forEach(c => updateControl(c.key));
      renderExito();
      save();
    }

    function applyScenario(key){
      const sc = scenarios[key];
      if(!sc) return;
      const d = sc.deltas;
      for(const k in d){
        if(k === 'Sala' && document.getElementById('linkSO').checked){
          state.Sala = clamp(state.Sala + d[k]);
          state.Online = clamp(100 - state.Sala);
        } else if(k === 'Online' && document.getElementById('linkSO').checked){
          state.Online = clamp(state.Online + d[k]);
          state.Sala = clamp(100 - state.Online);
        } else {
          state[k] = clamp((state[k] ?? 0) + d[k]);
        }
      }
      document.getElementById('scenarioNote').classList.remove('hidden');
      document.getElementById('scenarioNote').textContent = `Aplicado: ${sc.label}.`;
      updateAll();
      // animación leve en éxito
      const bar = document.getElementById('exitoBar');
      bar.classList.add('animate-pulse');
      setTimeout(()=>bar.classList.remove('animate-pulse'), 600);
    }

    // ----------------------------
    // Inicialización
    // ----------------------------
    function init(){
      load();
      renderControls();
      updateAll();

      document.getElementById('linkSO').checked = !!state.linkSO;
      document.getElementById('linkSO').addEventListener('change', ()=>{
        if(document.getElementById('linkSO').checked){
          // reequilibrar automáticamente
          state.Online = clamp(100 - state.Sala);
          updateControl('Online');
        }
        updateAll();
      });

      document.querySelectorAll('.scenario').forEach(btn => {
        btn.addEventListener('click', () => applyScenario(btn.dataset.scenario));
      });

      document.getElementById('btnReset').addEventListener('click', () => {
        localStorage.removeItem('everest_state');
        Object.assign(state, { Omnicanalidad:55, Satisfaccion:75, Riesgo:35, Popularidad:60, Margen:55, Sala:50, Online:50, linkSO:true });
        renderControls();
        updateAll();
        document.getElementById('scenarioNote').classList.add('hidden');
      });

      document.getElementById('btnExport').addEventListener('click', () => {
        const data = new Blob([JSON.stringify(state, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(data);
        const a = document.createElement('a');
        a.href = url; a.download = 'everest_state.json'; a.click();
        URL.revokeObjectURL(url);
      });

      document.getElementById('fileImport').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try{ const obj = JSON.parse(reader.result); Object.assign(state, obj); renderControls(); updateAll(); }
          catch(err){ alert('JSON inválido.'); }
        };
        reader.readAsText(file);
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pause & Play — Everest Omnicanal (Juego)</title>
    <link rel="icon" href="data:,">

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root { color-scheme: dark; }
      body { background: linear-gradient(to bottom, #111827, #0b0f19, #000); color: #fff; }
      .card { border: 1px solid #374151; background: rgba(31,41,55,0.7); border-radius: 1rem; }
      .progress { height: 8px; border-radius: 9999px; background: #374151; overflow: hidden }
      .progress > div { height: 100%; background: #ef4444; transition: width .25s ease; }
      .btn { border-radius: .75rem; font-weight: 600; padding: .6rem 1rem; }
      .btn-primary { background: #dc2626; } .btn-primary:hover { background: #b91c1c; }
      .btn-secondary { background: #374151; } .btn-outline { border: 1px solid #4b5563; }
      .btn-outline:hover { border-color: #ef4444; }
      .btn:disabled { opacity:.5; cursor:not-allowed; }
      .opt-picked { border-color:#f87171 !important; background:rgba(239,68,68,.08) !important; }
      .badge { font-size:.7rem; padding:.15rem .45rem; border:1px solid #4b5563; border-radius:.45rem; background:#111827; }
      .logbox { max-height: 320px; overflow: auto; }
    </style>

    <!-- React + ReactDOM -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Framer Motion -->
    <script src="https://cdn.jsdelivr.net/npm/framer-motion/dist/framer-motion.umd.js"></script>

    <!-- Babel -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div class="p-6 md:p-10"><div id="root"></div></div>

    <script type="text/babel" data-presets="react">
      const FM = window['framer-motion'] || {};
      const motion = FM.motion || new Proxy({}, { get: () => (props) => React.createElement('div', props) });
      const AnimatePresence = FM.AnimatePresence || (({children}) => children);

      const { useState, useMemo, useEffect } = React;
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
      const rnd = (n) => Math.round(n);

      const fx = {
        play: (name, vol=0.5, muted=false) => { 
          if (muted) return; 
          const a = new Audio('sounds/' + name + '.mp3'); 
          a.volume = vol; 
          a.play().catch(() => {}); 
        }
      };

      // =======================
      // CONFIG MODO DIFÍCIL
      // =======================
      const DIFFICULTY = {
        posScale: 0.8,
        negScale: 1.1,
        softCaps: {
          ltv:           [78, 86, 92, 96, 100],
          satisfaction:  [85, 90, 94, 97, 100],
          omni:          [82, 88, 93, 97, 100],
          online:        [88, 92, 96, 98, 100],
          offline:       [88, 92, 96, 98, 100],
          risk:          [100,100,100,100,100],
          popularity:    [90, 94, 97, 99, 100],
          margin:        [80, 88, 92, 96, 100],
        },
        fatiguePenalty: { omni: 4, sat: 3, ltv: 2, risk: 4 },
        diminishingStart: 80
      };

      const softCapFor = (metric, levelIndex) => {
        const caps = DIFFICULTY.softCaps[metric] || [100,100,100,100,100];
        return caps[Math.min(levelIndex, caps.length-1)];
      };

      function applyPosWithCaps(current, delta, levelCap) {
        if (delta <= 0) return delta;
        let d = delta * DIFFICULTY.posScale;
        const start = DIFFICULTY.diminishingStart;
        if (current >= start) {
          const factor = clamp(1 - ((current - start) / (100 - start)), 0.15, 1);
          d *= factor;
        }
        if (current >= levelCap) {
          d *= 0.2;
        } else if (current + d > levelCap) {
          const extra = (current + d) - levelCap;
          d -= extra * 0.5;
        }
        return d;
      }

      function applyNegWithDifficulty(delta) {
        if (delta >= 0) return delta;
        return delta * DIFFICULTY.negScale;
      }

      function biasOfImpact(impact) {
        const on = impact.online_activity ?? 0;
        const off = impact.offline_activity ?? 0;
        if (on - off > 6) return 'online';
        if (off - on > 6) return 'offline';
        return 'balanced';
      }

      // =======================
      // COMPONENTES DE UI
      // =======================
      const ProgressBar = ({ value=0, color='#ef4444' }) => {
        const v = clamp(Math.round(value), 0, 100);
        return <div className="progress w-full"><div style={{width: v+'%', background: color}}></div></div>;
      };

      function HUD({ ltv, omni, satisfaction, risk, online, offline, popularity, margin }) {
        const items = [
          {label:'💰 LTV',val:rnd(ltv),color:'#22c55e'},
          {label:'🔄 Omnicanalidad',val:rnd(omni),isPct:true,color:'#60a5fa'},
          {label:'❤️ Satisfacción',val:rnd(satisfaction),isPct:true,color:'#f97316'},
          {label:'⚠️ Riesgo',val:rnd(risk),isPct:true,color:'#ef4444'},
          {label:'📣 Popularidad',val:rnd(popularity),isPct:true,color:'#eab308'},
          {label:'📈 Margen',val:rnd(margin),isPct:true,color:'#10b981'},
          {label:'🏪 Sala',val:rnd(offline),isPct:true,color:'#a78bfa'},
          {label:'💻 Online',val:rnd(online),isPct:true,color:'#34d399'}
        ];
        return (
          <div className="mt-6 grid sm:grid-cols-2 md:grid-cols-4 xl:grid-cols-8 gap-4">
            {items.map((m) => (
              <div key={m.label} className="card">
                <div className="p-4">
                  <p className="text-xs text-gray-300/80">{m.label}</p>
                  <div className="flex items-center gap-3 mt-2">
                    <ProgressBar value={m.val} color={m.color} />
                    <span className="text-sm text-gray-200 w-12 text-right">
                      {m.isPct?`${clamp(m.val,0,100)}%`:clamp(m.val,0,100)}
                    </span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        );
      }

      function SuccessPanel({ success }){
        const tag = success<40 ? 'fracaso' : success<60 ? 'inestable' : success<75 ? 'correcto' : success<90 ? 'muy bueno' : 'excelencia';
        const color = success>=90? '#16a34a' : success>=75? '#22c55e' : success>=60? '#f59e0b' : success>=40? '#fbbf24' : '#ef4444';
        return (
          <div className="card">
            <div className="p-5">
              <div className="flex items-baseline justify-between">
                <div>
                  <div className="text-4xl font-bold">{success}</div>
                  <div className="text-xs text-gray-300/80">Éxito del Casino (0–100)</div>
                </div>
                <span className="badge" style={{borderColor:color,color}}>{tag}</span>
              </div>
              <div className="mt-3"><ProgressBar value={success} color={color} /></div>
            </div>
          </div>
        );
      }

      // Transición de tiempo entre campamentos
      function TransitionTime({ months, onEnd }) {
        const labels = {
          1: "📅 1 mes después...",
          3: "📅 3 meses después...",
          6: "📅 6 meses después...",
          9: "📅 9 meses después...",
          12: "📅 1 año después..."
        };
        return (
          <motion.div
            className="fixed inset-0 flex items-center justify-center bg-black/80 text-3xl md:text-4xl font-bold text-red-400 z-50"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 1.5 }}
            onAnimationComplete={() => setTimeout(onEnd, 1500)}
          >
            {labels[months] || "📅 Tiempo después..."}
          </motion.div>
        );
      }

            // =======================
      // CAMPAMENTOS / NIVELES
      // =======================
      const LEVELS = [
        {
          title: "🏕️ Campamento 0 — Captación",
          months: 0,
          bases: [
            {
              title: "Estrategias de captación",
              desc: "Vías de captación de clientes para el Casino:",
              options: [
                { text: "Campañas SEO + SEM", impact: { margin: +4, risk: +1, popularity: +3, omni: +1 } },
                { text: "Acuerdos con Streamers", impact: { margin: -3, risk: +3, popularity: +5, omni: +1 } },
                { text: "Campañas de registro desde los locales", impact: { margin: +1, risk: +1, popularity: +2, omni: +4, offline: +3 } }
              ]
            },
            {
              title: "Promoción de bienvenida",
              desc: "Promoción que utilizaremos para potenciar los registros:",
              options: [
                { text: "200% de primer depósito", impact: { margin: -2, risk: +2, popularity: +4 } },
                { text: "20€ sin depósito", impact: { margin: -3, risk: +3, popularity: +3 } },
                { text: "Sin bono (Marca premium)", impact: { margin: +3, risk: -2, popularity: -1 } }
              ]
            }
          ],
          event: {
            title: "¡Necesitamos registros!",
            desc: "Quieres hacer push para potenciar registros durante un mes:",
            options: [
              { text: "Competición de registros desde los locales con Ranking", impact: { popularity: +3, omni: +2, risk: +1 } },
              { text: "Campaña de Twitch con Streamer TOP", impact: { popularity: +4, margin: -2, risk: +2 } },
              { text: "Sin evento (Ahorro)", impact: { margin: +2 } }
            ]
          }
        },
        {
          title: "⚡ Campamento 1 — Activación",
          months: 1,
          bases: [
            {
              title: "Clientes registrados sin verificación",
              desc: "El 45% de los nuevos registros no han completado su verificación:",
              options: [
                { text: "Bloqueo de cuenta hasta su verificación", impact: { risk: -3, satisfaction: -3, popularity: -2 } },
                { text: "Activar promociones únicamente para clientes verificados", impact: { risk: -2, satisfaction: 0, omni: +1 } },
                { text: "No intervenir y esperar acción del cliente", impact: { risk: +3, satisfaction: -1 } }
              ]
            },
            {
              title: "Clientes activos sin primer depósito",
              desc: "Los jugadores han jugado en modo demo o navegan por la app, pero aún no depositan:",
              options: [
                { text: "Estrategia de mailing con bono de bienvenida", impact: { margin: -1, popularity: +3 } },
                { text: "Crear campaña agresiva de urgencia (300%)", impact: { margin: -3, risk: +2, popularity: +4 } },
                { text: "Campaña de llamadas desde Atención al Cliente + Sala con promoción exclusiva", impact: { margin: -2, omni: +3, popularity: +2 } },
                { text: "No intervenir y esperar acción del cliente", impact: { margin: +1, satisfaction: -2 } }
              ]
            }
          ],
          event: {
            title: "Fallo en la web",
            desc: "Durante la campaña de activación, Alira se cae durante 4 horas. Los usuarios no pueden completar su verificación ni acceder al bono:",
            options: [
              { text: "Comunicar en web y publicar promoción en compensación", impact: { satisfaction: +4, margin: -2 } },
              { text: "Enviar promoción solo a clientes molestos que presenten quejas", impact: { satisfaction: +2, margin: -1 } },
              { text: "Ignorar el problema y priorizar la campaña", impact: { risk: +3, satisfaction: -3 } }
            ]
          }
        },
        {
          title: "🔁 Campamento 2 — Retención",
          months: 3,
          bases: [
            {
              title: "Caída de actividad tras el primer depósito",
              desc: "Detectas una bajada del rendimiento tras una gran campaña de activación:",
              options: [
                { text: "Campaña para invitar a los clientes a una fiesta en los locales Pause&Play", impact: { offline: +3, omni: +2, popularity: +3, margin: -1 } },
                { text: "Rediseño de la web para darle otro enfoque", impact: { online: +3, satisfaction: +3, margin: -2 } },
                { text: "Lanzamiento de la APP CasinoPause&Play (requiere inversión alta pero mejora experiencia a largo plazo)", impact: { omni: +4, online: +3, margin: -3, satisfaction: +2 } }
              ]
            },
            {
              title: "Baja participación en promociones semanales",
              desc: "El calendario de promociones online no tiene buena acogida y el ROI está cayendo:",
              options: [
                { text: "Segmentar las promociones por valor para hacerlas más atractivas", impact: { satisfaction: +3, margin: -1 } },
                { text: "Duplicar las promociones durante un tiempo", impact: { satisfaction: +4, margin: -3, risk: +1 } },
                { text: "Crear nuevos formatos (desafíos semanales, minijuegos propios)", impact: { satisfaction: +3, popularity: +3, margin: -2 } }
              ]
            }
          ],
          event: {
            title: "Nuevo Lanzamiento",
            desc: "Un proveedor TOP nos elige para darnos en exclusiva su lanzamiento más esperado del año:",
            options: [
              { text: "Lanzar campaña multicanal + posicionamiento premium en web", impact: { popularity: +4, margin: -2, omni: +2 } },
              { text: "Lanzamiento anticipado de 2 días para clientes VIP", impact: { satisfaction: +3, popularity: +2, margin: -1 } },
              { text: "Promoción de FreeSpins exclusiva para clientes de los locales", impact: { offline: +3, omni: +3, margin: -2 } }
            ]
          }
        },
        {
          title: "⚖️ Campamento 3 — Riesgo",
          months: 6,
          bases: [
            {
              title: "Jugador intensivo Omnicanal",
              desc: "Un cliente con alta actividad tanto en sala como online muestra sesiones prolongadas y depósitos frecuentes:",
              options: [
                { text: "Hacer estudio de riesgo y reducir privilegios", impact: { risk: -4, satisfaction: -2 } },
                { text: "Enviar comunicación responsable sobre juego seguro", impact: { risk: -2, satisfaction: 0 } },
                { text: "Seguimiento discreto hasta detectar patrones más claros", impact: { risk: -1, satisfaction: 0 } }
              ]
            },
            {
              title: "Solicitud de exclusión voluntaria",
              desc: "Cliente con alta actividad nos pide tomarse un descanso:",
              options: [
                { text: "Bloqueo de cuenta inmediato y solicitar autoexclusión", impact: { risk: -3, satisfaction: -2 } },
                { text: "Contactar con él para analizar riesgos (añade nota extra)", impact: { satisfaction: +1, risk: -2 } },
                { text: "Intentar disuasión bajando límites y retrasar el trámite", impact: { risk: +2, margin: +1, satisfaction: -3 } }
              ]
            }
          ],
          event: {
            title: "Nueva regulación",
            desc: "La DGOJ anuncia una norma que exige avisos de pausa automática y límites por defecto más bajos:",
            options: [
              { text: "Adelantar cumplimiento y aplicar límites cuanto antes", impact: { risk: -4, margin: -1, popularity: +1 } },
              { text: "Plan gradual: aplicarlo a nuevos clientes primero", impact: { risk: -2, satisfaction: +1 } },
              { text: "Esperar a publicación oficial y retrasar aplicación", impact: { risk: +2, margin: +2 } }
            ]
          }
        },
        {
          title: "🏆 Campamento 4 — Fidelización",
          months: 9,
          bases: [
            {
              title: "Club VIP Omnicanal",
              desc: "Integrar los programas de fidelización de salas físicas y online bajo una misma marca: Club VIP Omnicanal.",
              options: [
                { text: "Modelo conjunto (beneficios cruzados)", impact: { satisfaction: +3, omni: +4, margin: -1 } },
                { text: "Modelo espejo (beneficios compensados)", impact: { satisfaction: +2, omni: +3 } },
                { text: "Modelo paralelo (preferencias separadas)", impact: { satisfaction: +1, margin: +1 } }
              ]
            },
            {
              title: "Diseño de beneficios y recompensas",
              desc: "El club necesita una propuesta de valor clara para retener y motivar sin generar dependencia:",
              options: [
                { text: "Experiencias exclusivas (viajes, eventos, regalos)", impact: { satisfaction: +4, popularity: +2, margin: -2 } },
                { text: "Recompensas web (cashback, misiones VIP...)", impact: { satisfaction: +3, margin: -1, popularity: +1 } },
                { text: "Reconocimientos simbólicos (trofeos digitales...)", impact: { satisfaction: +2, popularity: +1 } },
                { text: "Bonificación agresiva (altos cashbacks)", impact: { satisfaction: +3, risk: +3, margin: -3 } }
              ]
            }
          ],
          event: {
            title: "¡Quiero mi promoción!",
            desc: "Un grupo de jugadores regulares (no VIP) se queja en redes por el trato desigual del club:",
            options: [
              { text: "Explicación pública sobre meritocracia y transparencia", impact: { popularity: +2, satisfaction: +2 } },
              { text: "Abrir sección intermedia (plata/oro) con mejoras menores", impact: { satisfaction: +3, margin: -1 } },
              { text: "Mantener exclusividad del club", impact: { satisfaction: -1, margin: +2 } }
            ]
          }
        },
        {
          title: "🏔️ Campamento 5 — Consolidación de Marca",
          months: 12,
          bases: [
            {
              title: "Pause&PlayBet.es",
              desc: "La empresa recibe la licencia de juego AADD para operar apuestas deportivas en España. Representa un avance clave en la consolidación como operador regulado y omnicanal.",
              options: [
                { text: "Lanzar una nueva marca específica para apuestas deportivas", impact: { popularity: +3, margin: -2, omni: +1 } },
                { text: "Integrar las apuestas deportivas dentro del casino", impact: { popularity: +2, omni: +3, margin: 0 } },
                { text: "Crear una submarca vinculada (pauseandplaybet.es)", impact: { popularity: +3, margin: +1, omni: +2 } }
              ]
            },
            {
              title: "Experiencia Total Omnicanal",
              desc: "Pause & Play quiere consolidar su modelo conectando completamente la experiencia física y digital:",
              options: [
                { text: "Instalar terminales en todos los locales", impact: { offline: +3, omni: +3, margin: -2 } },
                { text: "Probar modelo en centros estratégicos y escalar", impact: { offline: +2, omni: +2, margin: 0 } },
                { text: "Priorizar comunidades con madurez digital", impact: { omni: +3, margin: +1, risk: -1 } }
              ]
            }
          ],
          event: {
            title: "Siguientes pasos",
            desc: "Después de años de evolución, Pause & Play ha alcanzado la cima del sector como operador omnicanal con presencia nacional y licencia AADD. La dirección debe decidir el rumbo futuro:",
            options: [
              { text: "Expandir fronteras (internacionalizar modelo omnicanal)", impact: { popularity: +4, risk: +2, margin: -2 } },
              { text: "Innovar la experiencia (IA, VR, streaming...)", impact: { satisfaction: +4, risk: +1, margin: -1 } },
              { text: "Diversificar el negocio (nuevas líneas de ocio)", impact: { margin: +3, risk: 0, popularity: +2 } }
            ]
          }
        }
      ];
      
      // ... [lógica de juego: navegación, impactos y renderizado principal iría aquí, igual al motor existente] ...
    </script>
  </body>
</html>
